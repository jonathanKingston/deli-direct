let places = [{"blurb":"Online beer shop based in Nottingham. Supplying beer from local breweries to local customers.","collect":false,"location":false,"postage":true,"title":"Adventure Beer","types":["alcohol","drink"],"website":"https://adventurebeer.co.uk/"},{"blurb":"Italian Bar & Restaurant in Beeston","collect":true,"facebook":"https://www.facebook.com/Amores-274600903024469/","phone":"+441159222266","title":"Amore's","website":"https://www.amoresrestaurantbeeston.co.uk/"},{"blurb":"Nottingham’s first ever self-serve wine bar located in Trinity Square now offering delivery.","delivers":true,"facebook":"https://www.facebook.com/Anotherwinebar/","instagram":"https://www.instagram.com/anotherwinebar/","title":"Another wine bar","website":"http://anotherwinebar.co.uk/"},{"blurb":"Fruit & vegetable shop in Nottingham, United Kingdom","delivers":true,"location":{"lat":52.96646699999999,"lng":-1.1858744},"title":"Anthony's Fruit and Vegetables","types":["greengrocer"],"website":"https://www.facebook.com/anthonysboxes/"},{"blurb":"Local farm shop that is accepting collections","collect":true,"facebook":"https://www.facebook.com/ArrowFarmShop/","title":"Arrow Farm Shop","types":["greengrocer"],"website":"https://arrowfarmshop.co.uk/"},{"blurb":"Product/service in Nottingham, United Kingdom","collect":true,"delivers":true,"facebook":"https://www.facebook.com/Avocafe.Nutri2Go/","location":{"lat":52.9514283,"lng":-1.1733636},"title":"AvoCafe by Nutri-Go","types":["greengrocer"]},{"collect":true,"location":{"lat":52.9868047,"lng":-0.9776788999999999},"phone":"+44115 966 4833","title":"Biondi Bistro","website":"http://biondi-bistro.com/"},{"blurb":"Nottingham craft ciders offering delivery","delivers":true,"facebook":"https://facebook.com/BlueBarrelCider/","title":"Blue Barrel Cider","types":["alcohol","drink"]},{"collect":true,"delivers":true,"location":{"lat":52.9837359,"lng":-1.1230325},"title":"Bread and Bitter","twitter":"https://twitter.com/breadandbitter","website":"https://www.castlerockbrewery.co.uk/pubs/bread-and-bitter/"},{"blurb":"Nottingham bottle shop offering online deliveries.","instagram":"https://www.instagram.com/brewcavern/","postage":true,"title":"Brew Cavern","website":"https://brewcavern.co.uk/"},{"blurb":"Wine, beer and spirits shop in Nottingham, United Kingdom","delivers":true,"facebook":"https://www.facebook.com/brigittebordeauxwine","instagram":"https://www.instagram.com/brigittebordeauxwine/","location":{"lat":52.9791758,"lng":-1.1474493},"phone":"0115 9620212","title":"Brigitte Bordeaux","types":["alcohol","drink"],"website":"https://www.brigittebordeauxwine.co.uk/"},{"blurb":"Deli offering pre-orders in the East Leake area.","collect":true,"email":"orders@bryersdeli.com","facebook":"https://www.facebook.com/bryerseastleake/","title":"Bryer's East Leake"},{"collect":true,"deliveroo":"https://deliveroo.co.uk/menu/nottingham/lenton/buns-and-burgers-ntg","delivers":true,"justeat":"https://www.just-eat.co.uk/restaurants-bunsburgers-nottingham/menu","phone":"0115 841 0086","title":"Buns and Burgers"},{"instagram":"https://www.instagram.com/allminecakes/","location":{"lat":53.0922998,"lng":-0.9612767999999999},"postage":true,"title":"Cafe All Mine Cakes","website":"https://www.allminecakes.co.uk/"},{"delivers":true,"facebook":"https://www.facebook.com/cafezerouk/","location":{"lat":53.002796,"lng":-1.1280648},"title":"Cafe Zero"},{"delivers":true,"instagram":"https://www.instagram.com/canvasandcoffeeuk/","location":{"lat":52.919449,"lng":-1.227426},"title":"Canvas & Coffee","website":"http://canvasandcoffee.uk/"},{"blurb":"Cafe offering meals to take away","collect":true,"facebook":"https://www.facebook.com/carriagescafe/","instagram":"https://www.instagram.com/carriagescafe/","location":{"lat":52.8850072,"lng":-1.0806468},"phone":"01636676129","title":"Carriages Cafe","website":"https://www.carriagesnewark.co.uk/"},{"location":{"lat":52.9514322,"lng":-1.1476908},"postage":true,"title":"Cartwheel Cafe and Roastery","website":"https://shop.cartwheelcoffee.com/"},{"delivers":true,"postage":true,"title":"Castle Rock Brewery","types":["alcohol","drink"],"website":"https://castlerockbreweryshop.com/"},{"blurb":"Butchers offering free delivery","delivers":true,"facebook":"https://www.facebook.com/Chambers-butchers-Nottingham-228400460529940/","phone":"01159267034","title":"Chambers Butchers"},{"delivers":true,"facebook":"https://www.facebook.com/clemievegancake/","location":{"lat":53.0354842,"lng":-1.2042463},"title":"Clemie's Vegan Cakes"},{"collect":true,"delivers":true,"location":{"lat":52.9715631,"lng":-1.153139},"title":"Cod's Scallops Carrington"},{"collect":true,"delivers":true,"location":{"lat":52.8973132,"lng":-1.271017},"title":"Cod's Scallops Long Eaton"},{"collect":true,"delivers":true,"location":{"lat":52.9461247,"lng":-1.2329118},"title":"Cod's Scallops Wollaton"},{"collect":true,"delivers":true,"facebook":"https://www.facebook.com/cornerstonepizzas/","location":{"lat":52.982072,"lng":-1.1453958},"title":"Cornerstone Pizza"},{"blurb":"Delivering essentials, meat and potatoes in Beeston and around Nottingham.","delivers":true,"facebook":"https://www.facebook.com/johndawsonbutchers/","phone":"0115 925 5101","title":"Craig Dawson Butchers"},{"delivers":true,"location":{"lat":52.90589319999999,"lng":-1.2606296},"title":"Craig Floate","website":"https://www.craigfloatechef.com/"},{"collect":true,"delivers":true,"facebook":"https://www.facebook.com/Dandelion.kimberley/","location":{"lat":52.9974639,"lng":-1.2565679},"phone":"0115 9385556","title":"Dandelion Deli Coffee"},{"blurb":"Beeston hidden bar delivering drinks and cocktails","collect":true,"delivers":true,"instagram":"https://www.instagram.com/dasschuhzimmer/","location":{"lat":52.9224942,"lng":-1.2208611},"title":"Das Schuhzimmer","website":"http://www.dasschuhzimmer.com/"},{"blurb":"Allowing our customers to taste and try new and deli foods, with the confidence that they are tasting the best.","collect":true,"delivers":true,"email":"food@delilahfinefoods.co.uk","facebook":"https://www.facebook.com/DelilahFineFoods/","instagram":"https://www.instagram.com/delilahfinefoods/","location":{"lat":52.95315170000001,"lng":-1.1463852},"phone":"+44115 948 4461","title":"Delilah Fine Foods","types":["deli","greengrocer"],"website":"https://delilahfinefoods.co.uk/"},{"collect":true,"deliveroo":"https://deliveroo.co.uk/menu/nottingham/nottingham-city-centre/dhoris-kitchen","delivers":true,"title":"Dhoris Kitchen"},{"blurb":"Speciality food shop offering deliveries","delivers":true,"facebook":"https://www.facebook.com/eastmidsfinefoods/","location":{"lat":52.95315170000001,"lng":-1.1463852},"title":"East Midlands Fine Foods"},{"collect":true,"delivers":true,"facebook":"https://www.facebook.com/Emilios-Greek-Restaurant-127944187301672/","location":{"lat":53.0023613,"lng":-1.1294101},"phone":"0115 926 2550","title":"Emilio’s Greek Restaurant","website":"https://www.emiliosgreekrestaurant.co.uk/"},{"delivers":true,"location":{"lat":52.9555072,"lng":-1.1494865},"title":"Filthy Vegan Takeout","website":"https://thefilthyvegan.co.uk/"},{"blurb":"Purveyors of high quality Fresh fish, fruit and vegetables. Fresh Fish Road Show","collect":true,"delivers":true,"facebook":"https://www.facebook.com/fred.hallamltd/","location":{"lat":52.9272164,"lng":-1.2151484},"title":"Fred Hallam","types":["greengrocer"],"website":"https://fredhallam.shop/"},{"blurb":"A truly independent, traditional, family Farm shop specialising in home reared meat & local produce.","collect":true,"facebook":"https://www.facebook.com/HarkersFarmShop/","title":"Harkers Farm Shop","types":["greengrocer"],"website":"http://www.harkersfarmshop.co.uk/"},{"blurb":"Lovely little café located just off the marketplace in Kegworth offering take away only.","collect":true,"facebook":"https://www.facebook.com/hiddengemkitchen/","location":{"lat":52.8358905,"lng":-1.2790617},"phone":"07549 306319","title":"Hidden Gem Kitchen"},{"blurb":"Treats and cakes at the forest recreation ground.","collect":true,"facebook":"https://www.facebook.com/Homemadecafe/","instagram":"https://www.instagram.com/homemadecafe/","title":"Home made cafe","website":"https://www.homemadecafe.com/"},{"location":{"lat":52.9618933,"lng":-1.2234645},"postage":true,"title":"Hopwells","website":"https://www.hopwells.com/"},{"collect":true,"delivers":true,"location":{"lat":52.9508652,"lng":-1.1433024},"title":"Hungry Pumpkin","website":"http://hungrypumpkin.co.uk/"},{"delivers":true,"instagram":"https://www.instagram.com/indulgeinnotts/","location":{"lat":52.9702756,"lng":-1.1621913},"title":"Indulge In","website":"https://www.indulge-in.co.uk/"},{"collect":true,"delivers":true,"facebook":"https://www.facebook.com/Joes-Cafe-Colwick-2397876140252104/","location":{"lat":52.9601213,"lng":-1.0827286},"phone":"07796101798","title":"Joe's Cafe Colwick"},{"location":{"lat":52.9543719,"lng":-1.1524793},"postage":true,"title":"Kaffee haus","website":"https://kaffeehaus.co.uk/"},{"blurb":"A local family business delivering Fruit and Vegetables, Meat, Fish and other essentials.","delivers":true,"location":{"lat":52.9214286,"lng":-1.0288016},"title":"Kerry's Fresh","website":"https://www.kerrysfresh.co.uk/"},{"blurb":"Korean food in Beeston offering take away only currently.","collect":true,"facebook":"https://www.facebook.com/pg/koreahousebeeston","location":{"lat":52.929513,"lng":-1.211005},"phone":"0115 967 7566","title":"Korea House Restaurant"},{"collect":true,"facebook":"https://www.facebook.com/KraftWerks/","location":{"lat":52.9804123,"lng":-1.1470826},"postage":true,"title":"Kraft Werks","website":"http://www.kraft-werks.com/"},{"blurb":"Local supplier of hand delivered fruit and vegetables. Also supplying milk, eggs, cereals and water to home or work!","collect":true,"delivers":true,"facebook":"https://www.facebook.com/lardertree/","location":{"lat":52.94496050000001,"lng":-1.1347406},"phone":"0115 981 0100","title":"Larder Tree","website":"http://lardertree.co.uk/"},{"blurb":"Nottingham chef offering affordable meals and emergency services free meals!","delivers":true,"location":false,"title":"Louisa Ellis","twitter":"https://twitter.com/louisaellis95/","website":"https://www.cheflouisaellis.com/"},{"blurb":"Luigi's Ristorante in Arnold serving Italian cuisine.","delivers":true,"facebook":"https://www.facebook.com/Luigis-160101700672151/","title":"Luigi's"},{"postage":true,"title":"Luisa's Vegan Chocolates","website":"https://luisasveganchocolates.co.uk/"},{"blurb":"Ethical festival cafe, falafel stall doing deliveries free to nottingham","delivers":true,"facebook":"https://www.facebook.com/MagpieBrewery/","postage":true,"title":"Magpie Brewery","twitter":"https://twitter.com/MagpieBrewery","website":"http://www.magpiebrewery.com/"},{"collect":true,"delivers":true,"facebook":"https://www.facebook.com/maxeysfarm/","phone":"01636 814566","title":"Maxeys Farm Shop","types":["greengrocer"],"website":"https://www.maxeysfarmshop.co.uk/"},{"blurb":"Family run butchers in the heart of the midlands established in 1935","collect":true,"delivers":true,"phone":"01636 370 556","title":"Meat and Co","website":"https://www.meatandco.co.uk/"},{"delivers":true,"location":{"lat":52.9536587,"lng":-1.1381994},"title":"Neon Raptor","website":"https://www.neonraptorbrewingco.com/"},{"delivers":true,"facebook":"https://www.facebook.com/No.TwelveNottingham/","location":{"lat":52.9522883,"lng":-1.1504145},"title":"No. Twelve","website":"https://www.no12nottingham.co.uk/"},{"blurb":"Ethical festival cafe, falafel stall doing deliveries","delivers":true,"facebook":"https://www.facebook.com/NuminumsCafe/","instagram":"https://www.instagram.com/numinums_cafe/","title":"Numinums"},{"blurb":"Burger joint offering collection after booking via phone, discounts for NHS","collect":true,"facebook":"https://www.facebook.com/pages/category/Burger-Restaurant/Ohannes-Burger-UK-110446866989701/","location":{"lat":53.0011339,"lng":-1.1306648},"phone":"01156761818","title":"Ohannes Burgers"},{"collect":false,"delivers":true,"facebook":"https://www.facebook.com/okendecoffee/","location":{"lat":52.9298836,"lng":-1.125556},"title":"Okende","twitter":"https://twitter.com/okendecoffee","website":"https://www.okende.com/"},{"blurb":"Beeston bakery offering boozy cakes","delivers":true,"facebook":"https://www.facebook.com/oozeeboozeebakes/","title":"Oozee Boozee Bakes","types":["bakery"]},{"blurb":"Local coffee roaster supplying fair trade coffees","location":{"lat":52.9534396,"lng":-1.1437684},"postage":true,"title":"Outpost coffee","types":["coffee"],"website":"https://www.outpost.coffee/"},{"collect":true,"deliveroo":"https://deliveroo.co.uk/menu/nottingham/nottingham-city-centre/palb-catering-ltd-t-a-prickly-pear","delivers":true,"facebook":"https://www.facebook.com/pricklypearnottm/","location":{"lat":52.9614085,"lng":-1.1509245},"phone":"0115 958 1339","title":"Prickly Pear"},{"delivers":true,"facebook":"https://www.facebook.com/Raw-fruit-veg-402854009849461/","phone":"01949 831077","title":"Raw Fruit & Veg"},{"delivers":true,"location":{"lat":52.98299,"lng":-1.1454221},"title":"Rikshaw Urban Indian Kitchen","website":"https://rikshawonline.com/our_menu.php"},{"delivers":true,"instagram":"https://www.instagram.com/shipstonesbeer/","postage":true,"title":"Shipstones Brewery","types":["alcohol","drink"],"website":"http://www.shipstones.com/brewery-shop/"},{"delivers":true,"location":{"lat":52.9530417,"lng":-1.152423},"title":"Shop Zero Notts","website":"http://www.shopzero.co.uk/"},{"facebook":"https://www.facebook.com/TheSplitScreenCoffee/","instagram":"https://www.instagram.com/thesplitscreencoffee/","phone":"07812 555 896","postage":true,"title":"Split screen coffee","website":"https://www.thesplitscreencoffee.co.uk/shop"},{"blurb":"Spring Lane Farm Shop is a traditional, family run farm shop offering collection.","collect":true,"facebook":"https://www.facebook.com/springlanefarmshop","phone":"01159267624","title":"Spring lane farm shop","twitter":"https://twitter.com/SpringLaneFS","website":"https://www.springlanefarmshop.co.uk/"},{"blurb":"Trent bridge brewed coffee offering website delivery.","facebook":"https://www.facebook.com/StewartsCoffees/","instagram":"https://www.instagram.com/stewartscoffeesuk/","postage":true,"title":"Stewarts Coffee","website":"https://www.stewartscoffees.co.uk/"},{"delivers":true,"location":{"lat":52.9539276,"lng":-1.1457933},"title":"Studio Chocolate","website":"https://www.studio-chocolate.co.uk/"},{"blurb":"Farm shop offering collection of meals.","collect":true,"instagram":"https://www.instagram.com/thaymar_ice_cream/","phone":"01623 858887","title":"Thaymar Dairy Ice Cream","website":"https://www.thaymaricecream.co.uk"},{"facebook":"https://www.facebook.com/BeestonBrownieCo/","postage":true,"title":"The Beeston Brownie Co","website":"https://thebeestonbrowniecompany.co.uk/"},{"blurb":"Beeston bar delivering drinks and cocktails","delivers":true,"location":{"lat":52.922514,"lng":-1.220818},"title":"The Berliner","types":["alcohol","drink"],"website":"http://www.theberlinerbar.com/"},{"delivers":true,"instagram":"https://www.instagram.com/thebottletopnotts/","postage":true,"title":"The Bottle Top","types":["alcohol","drink"],"website":"https://www.thebottletopnotts.co.uk/beer"},{"collect":true,"location":{"lat":52.9527542,"lng":-1.1484425},"phone":"01159419114","title":"The Cheese Shop","twitter":"https://twitter.com/cheeseshopnottm"},{"delivers":true,"title":"The Country Victualler","website":"https://thecountryvictualler.co.uk/"},{"blurb":"Greengrocers offering delivery of fruit, veg and other items.","delivers":true,"location":{"lat":52.93055889999999,"lng":-1.1255994},"phone":"0115 784 1579","title":"The Fruit Basket","twitter":"https://twitter.com/NFBdirect","website":"http://www.thefruitbasketdirect.uk/"},{"blurb":"Fruit and vegtable shop in Mapperley.","collect":true,"title":"The Fruit Bowl","website":"https://www.facebook.com/The-Fruit-Bowl-Mapperley-1597571230463340/"},{"blurb":"Beeston tapas bar and restaurant offering takeout and delivery.","collect":true,"delivers":true,"location":{"lat":52.9232004,"lng":-1.2196913},"phone":"0115 922 8300","title":"The Frustrated Chef","website":"https://www.thefrustratedchef.co.uk/"},{"collect":true,"facebook":"https://facebook.com/TheGedlingInn/","location":{"lat":52.9748514,"lng":-1.0807171},"phone":"0115 987 8686","title":"The Gedling Inn"},{"blurb":"Pub with supplies and also take away Sunday dinners","collect":true,"delivers":true,"facebook":"https://www.facebook.com/LarwoodVocePubKitchen/","title":"The Larwood & Voce","twitter":"https://twitter.com/LarwoodVocePK","website":"https://www.larwoodandvoce.co.uk/take-away-menu.html"},{"blurb":"Local chef offering salads and other meals for delivery.","delivers":true,"facebook":"https://www.facebook.com/theLittleBrickhouse/","instagram":"https://www.instagram.com/littlebrickhouse_cafe/","location":{"lat":52.9821083,"lng":-1.1452747},"title":"The Little Brickhouse Cafe"},{"delivers":true,"location":{"lat":52.9818003,"lng":-1.1462256},"title":"The Pudding Pantry Sherwood","website":"http://www.thepuddingpantry.co.uk/"},{"blurb":"The Real Milk Company sells fresh, pasteurised milk, free range eggs, ice cream, bread & cakes straight from the farm","collect":true,"facebook":"https://www.facebook.com/realmilkcompany/","title":"The Real Milk Company","website":"http://www.therealmilkcompany.com"},{"blurb":"Local meal prep and dining experience foodies that are offering freezable bulk cooking.","delivery":true,"facebook":"https://www.facebook.com/thesensorykitchen/","instagram":"https://www.instagram.com/thesensorykitchen/","location":{"lat":52.949234,"lng":-1.1827506},"phone":"07771 610908","postage":true,"title":"The Sensory kitchen"},{"blurb":"Nottingham pour it yourself bar, now taking orders online via their website.","delivers":"true","facebook":"https://www.facebook.com/TheTapHouseNotts/","title":"The Tap House","website":"http://thetaphousenotts.co.uk/online-shop/"},{"delivers":true,"location":{"lat":52.9819454,"lng":-1.145667},"title":"The V Spot","website":"https://v-spot.co.uk/"},{"blurb":"Pub with supplies and also take away Sunday dinners","collect":true,"delivers":true,"location":{"lat":52.955451,"lng":-1.207904},"title":"The Wollaton Pub and Kitchen","website":"https://www.thewollaton.co.uk/"},{"blurb":"Independent bakery in Nottingham","delivers":true,"instagram":"https://www.instagram.com/toughmarysbakehouse/","location":{"lat":52.955442,"lng":-1.158548},"order":"https://docs.google.com/forms/d/e/1FAIpQLScsGc7DRgzqxJN03ZzOB_oky4vMdOKP3kKcx2fWwj6YxXpwBg/viewform","title":"Tough Mary's Bakehouse","types":["bakery"],"website":"http://www.toughmarysbakehouse.co.uk/"},{"collect":true,"facebook":"https://www.facebook.com/trinity.farm.9","title":"Trinity Farm Shop","types":["greengrocer"],"website":"http://www.trinityfarm.co.uk/"},{"deliveroo":"https://deliveroo.co.uk/menu/nottingham/nottingham-city-centre/viva-street-food","delivers":true,"location":{"lat":52.95366689999999,"lng":-1.1432996},"title":"Viva Street Food"},{"blurb":"Speciality wine shop delivering in Nottingham.","delivers":true,"facebook":"https://www.facebook.com/Weavers-Wines-120002801370966/","phone":"0115 958 0922","title":"Weavers wine","twitter":"https://twitter.com/weaverswines","website":"https://www.weaverswines.com/"},{"blurb":"Farm shop in Worksop supplying deli style food","collect":true,"facebook":"https://www.facebook.com/WelbeckCourtyard/","phone":"01909 478 725","title":"Welbeck Farm Shop","twitter":"https://twitter.com/welbeckfarmshop","types":["greengrocer","deli"],"website":"https://www.welbeckfarmshop.co.uk/"},{"delivers":true,"location":{"lat":52.9541221,"lng":-1.146712},"title":"Yamas","website":"https://www.yamas.co.uk/takeaway"}];const nottingham = [
  52.95448349999999,
  -1.1549223
];

function createLink(text, link, className) {
  return `<a href="${link}" class="${className}" rel="noopener noreferrer" target="_blank">${text}</a>`;
}

function placeCard(place, showMap) {
  let website = "";
  let blurb = "";
  let instagram = "";
  if (place.instagram) {
    instagram = createLink("Instagram", place.instagram, "instagram");
  }
  let facebook = "";
  if (place.facebook) {
    facebook = createLink("Facebook", place.facebook, "facebook");
  }
  let twitter = "";
  if (place.twitter) {
    twitter = createLink("Twitter", place.twitter, "twitter");
  }
  let phone = "";
  if (place.phone) {
    phone = createLink(place.phone, `tel:${place.phone}`, "phone");
  }
  if (place.blurb) {
    blurb = `<p class="blurb">${place.blurb}</p>`;
  }
  if (place.website) {
    website = createLink("Visit Website", place.website, "website");
  }
  let map = "";
  if (showMap && place.location) {
    let maplink = `https://www.google.com/maps/search/?api=1&query=${place.location.lat},${place.location.lng}`;
    map = createLink("Open Map", maplink, "map");
  }
  return `<div class="cardcontents">
    <h2>${place.title}</h2>
    <dl>
      <div><dt>Delivery:</dt><dd>${place.delivers || place.postage ? "Yes" : "No"}</dd></div>
      <div><dt>Collect:</dt><dd>${place.collect ? "Yes" : "No"}</dd></div>
    </dl>
    ${blurb}
    ${website}
    ${phone}
    ${map}
    <div class="icons">
      ${facebook} ${twitter} ${instagram}
    </div>
  </div>`;
}

async function init() {
  let toggleElement = getToggleElement();
  toggleElement.addEventListener("click", toggleView);
  initListView();

  changePreloadStyles();
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/sw.js");
  }
}

function changePreloadStyles() {
  let metas = [...document.getElementsByTagName("link")];
  for (let meta of metas) {
    if (meta.rel == "preload" && meta.as == "style") {
      meta.rel = "stylesheet";
    }
  }
}

function getListElement() {
  return document.getElementById("list");
}

function getListFilterElement() {
  return document.getElementById("listFilter");
}

function getMapElement() {
  return document.getElementById("map");
}

function getToggleElement() {
  return document.getElementById("toggleView");
}

let currentView = "list";

async function toggleView() {
  let mapElement = getMapElement();
  let listElement = getListElement();
  let listFilterElement = getListFilterElement();
  let toggleElement = getToggleElement();
  if (currentView == "list") {
    currentView = "map";
    toggleElement.innerText = "List view";
    mapElement.removeAttribute("hidden");
    listElement.setAttribute("hidden", "");
    listFilterElement.setAttribute("hidden", "");
    initMap();
  } else {
    currentView = "list";
    toggleElement.innerText = "Map view";
    listFilterElement.removeAttribute("hidden");
    listElement.removeAttribute("hidden");
    mapElement.setAttribute("hidden", "");
    initListView();
  }
}

function initListView() {
  getListFilterElement().addEventListener("change", () => {
    renderPlaces();
  });
  renderPlaces();
}

function renderPlaces() {
  let listElement = getListElement();
  listElement.innerHTML = "";
  for (let place of places) {
    let delivers = place.delivers || place.postage;
    let collect = place.collect;
    if (!deliversFilter.checked && !collect) {
      continue;
    }
    if (!collectFilter.checked && !delivers) {
      continue;
    }
    let placeContent = placeCard(place, true);
    let placeCardElement = document.createElement("div");
    placeCardElement.className = "card";
    placeCardElement.innerHTML = placeContent;
    listElement.appendChild(placeCardElement);
  }
}

function initMap() {
  let placePointers = L.layerGroup();
  for (let place of places) {
    if (place.location) {
      let popupContent = placeCard(place, false);
      L.marker([place.location.lat, place.location.lng]).bindPopup(popupContent).addTo(placePointers);
    }
  }

  let mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
  		'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
  		'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
  	mbUrl = 'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
  
  let grayscale = L.tileLayer(mbUrl, {id: 'mapbox/light-v9', tileSize: 512, zoomOffset: -1, attribution: mbAttr});
  
  let map = L.map('map', {
  	center: nottingham,
  	zoom: 16,
  	layers: [grayscale, placePointers]
  });
}
init();

// Google analytics crap
window.dataLayer = window.dataLayer || [];
window.gtag = window.gtag || function (){dataLayer.push(arguments);};
gtag('js', new Date());
gtag('config', 'UA-161955128-1');
